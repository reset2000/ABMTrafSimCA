\doxysection{Math\+Functions.\+h}
\hypertarget{arch_2_a_v_x512_2_math_functions_8h_source}{}\label{arch_2_a_v_x512_2_math_functions_8h_source}\index{Eigen/src/Core/arch/AVX512/MathFunctions.h@{Eigen/src/Core/arch/AVX512/MathFunctions.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ This\ file\ is\ part\ of\ Eigen,\ a\ lightweight\ C++\ template\ library}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ for\ linear\ algebra.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ Copyright\ (C)\ 2016\ Pedro\ Gonnet\ (pedro.gonnet@gmail.com)}}
\DoxyCodeLine{00005\ \textcolor{comment}{//}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ This\ Source\ Code\ Form\ is\ subject\ to\ the\ terms\ of\ the\ Mozilla}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ Public\ License\ v.\ 2.0.\ If\ a\ copy\ of\ the\ MPL\ was\ not\ distributed}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ with\ this\ file,\ You\ can\ obtain\ one\ at\ http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#ifndef\ THIRD\_PARTY\_EIGEN3\_EIGEN\_SRC\_CORE\_ARCH\_AVX512\_MATHFUNCTIONS\_H\_}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#define\ THIRD\_PARTY\_EIGEN3\_EIGEN\_SRC\_CORE\_ARCH\_AVX512\_MATHFUNCTIONS\_H\_}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespace_eigen}{Eigen}}\ \{}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{namespace\ }internal\ \{}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{comment}{//\ Disable\ the\ code\ for\ older\ versions\ of\ gcc\ that\ don't\ support\ many\ of\ the\ required\ avx512\ instrinsics.}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#if\ EIGEN\_GNUC\_AT\_LEAST(5,\ 3)\ ||\ EIGEN\_COMP\_CLANG\ \ ||\ EIGEN\_COMP\_MSVC\ >=\ 1923}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#define\ \_EIGEN\_DECLARE\_CONST\_Packet16f(NAME,\ X)\ \(\backslash\)}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\ \ const\ Packet16f\ p16f\_\#\#NAME\ =\ pset1<Packet16f>(X)}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#define\ \_EIGEN\_DECLARE\_CONST\_Packet16f\_FROM\_INT(NAME,\ X)\ \(\backslash\)}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\ \ const\ Packet16f\ p16f\_\#\#NAME\ =\ \ preinterpret<Packet16f,Packet16i>(pset1<Packet16i>(X))}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#define\ \_EIGEN\_DECLARE\_CONST\_Packet8d(NAME,\ X)\ \(\backslash\)}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\ \ const\ Packet8d\ p8d\_\#\#NAME\ =\ pset1<Packet8d>(X)}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#define\ \_EIGEN\_DECLARE\_CONST\_Packet8d\_FROM\_INT64(NAME,\ X)\ \(\backslash\)}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\ \ const\ Packet8d\ p8d\_\#\#NAME\ =\ \_mm512\_castsi512\_pd(\_mm512\_set1\_epi64(X))}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#define\ \_EIGEN\_DECLARE\_CONST\_Packet16bf(NAME,\ X)\ \(\backslash\)}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\ \ const\ Packet16bf\ p16bf\_\#\#NAME\ =\ pset1<Packet16bf>(X)}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#define\ \_EIGEN\_DECLARE\_CONST\_Packet16bf\_FROM\_INT(NAME,\ X)\ \(\backslash\)}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\ \ const\ Packet16bf\ p16bf\_\#\#NAME\ =\ \ preinterpret<Packet16bf,Packet16i>(pset1<Packet16i>(X))}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00039\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00040\ plog<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00041\ \ \ \textcolor{keywordflow}{return}\ plog\_float(\_x);}
\DoxyCodeLine{00042\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00045\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet8d}
\DoxyCodeLine{00046\ plog<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ \_x)\ \{}
\DoxyCodeLine{00047\ \ \ \textcolor{keywordflow}{return}\ plog\_double(\_x);}
\DoxyCodeLine{00048\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ plog)}
\DoxyCodeLine{00051\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ plog)}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00054\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00055\ plog2<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00056\ \ \ \textcolor{keywordflow}{return}\ plog2\_float(\_x);}
\DoxyCodeLine{00057\ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00060\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet8d}
\DoxyCodeLine{00061\ plog2<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ \_x)\ \{}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordflow}{return}\ plog2\_double(\_x);}
\DoxyCodeLine{00063\ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ plog2)}
\DoxyCodeLine{00066\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ plog2)}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \textcolor{comment}{//\ Exponential\ function.\ Works\ by\ writing\ "{}x\ =\ m*log(2)\ +\ r"{}\ where}}
\DoxyCodeLine{00069\ \textcolor{comment}{//\ "{}m\ =\ floor(x/log(2)+1/2)"{}\ and\ "{}r"{}\ is\ the\ remainder.\ The\ result\ is\ then}}
\DoxyCodeLine{00070\ \textcolor{comment}{//\ "{}exp(x)\ =\ 2\string^m*exp(r)"{}\ where\ exp(r)\ is\ in\ the\ range\ [-\/1,1).}}
\DoxyCodeLine{00071\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00072\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00073\ pexp<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00074\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(1,\ 1.0f);}
\DoxyCodeLine{00075\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(half,\ 0.5f);}
\DoxyCodeLine{00076\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(127,\ 127.0f);}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(exp\_hi,\ 88.3762626647950f);}
\DoxyCodeLine{00079\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(exp\_lo,\ -\/88.3762626647949f);}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_LOG2EF,\ 1.44269504088896341f);}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_exp\_p0,\ 1.9875691500E-\/4f);}
\DoxyCodeLine{00084\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_exp\_p1,\ 1.3981999507E-\/3f);}
\DoxyCodeLine{00085\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_exp\_p2,\ 8.3334519073E-\/3f);}
\DoxyCodeLine{00086\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_exp\_p3,\ 4.1665795894E-\/2f);}
\DoxyCodeLine{00087\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_exp\_p4,\ 1.6666665459E-\/1f);}
\DoxyCodeLine{00088\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_exp\_p5,\ 5.0000001201E-\/1f);}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \textcolor{comment}{//\ Clamp\ x.}}
\DoxyCodeLine{00091\ \ \ Packet16f\ x\ =\ pmax(pmin(\_x,\ p16f\_exp\_hi),\ p16f\_exp\_lo);}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \textcolor{comment}{//\ Express\ exp(x)\ as\ exp(m*ln(2)\ +\ r),\ start\ by\ extracting}}
\DoxyCodeLine{00094\ \ \ \textcolor{comment}{//\ m\ =\ floor(x/ln(2)\ +\ 0.5).}}
\DoxyCodeLine{00095\ \ \ Packet16f\ m\ =\ \_mm512\_floor\_ps(pmadd(x,\ p16f\_cephes\_LOG2EF,\ p16f\_half));}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \textcolor{comment}{//\ Get\ r\ =\ x\ -\/\ m*ln(2).\ Note\ that\ we\ can\ do\ this\ without\ losing\ more\ than\ one}}
\DoxyCodeLine{00098\ \ \ \textcolor{comment}{//\ ulp\ precision\ due\ to\ the\ FMA\ instruction.}}
\DoxyCodeLine{00099\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(nln2,\ -\/0.6931471805599453f);}
\DoxyCodeLine{00100\ \ \ Packet16f\ r\ =\ \_mm512\_fmadd\_ps(m,\ p16f\_nln2,\ x);}
\DoxyCodeLine{00101\ \ \ Packet16f\ r2\ =\ pmul(r,\ r);}
\DoxyCodeLine{00102\ \ \ Packet16f\ r3\ =\ pmul(r2,\ r);}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \textcolor{comment}{//\ Evaluate\ the\ polynomial\ approximant,improved\ by\ instruction-\/level\ parallelism.}}
\DoxyCodeLine{00105\ \ \ Packet16f\ y,\ y1,\ y2;}
\DoxyCodeLine{00106\ \ \ y\ \ =\ pmadd(p16f\_cephes\_exp\_p0,\ r,\ p16f\_cephes\_exp\_p1);}
\DoxyCodeLine{00107\ \ \ y1\ =\ pmadd(p16f\_cephes\_exp\_p3,\ r,\ p16f\_cephes\_exp\_p4);}
\DoxyCodeLine{00108\ \ \ y2\ =\ padd(r,\ p16f\_1);}
\DoxyCodeLine{00109\ \ \ y\ \ =\ pmadd(y,\ r,\ p16f\_cephes\_exp\_p2);}
\DoxyCodeLine{00110\ \ \ y1\ =\ pmadd(y1,\ r,\ p16f\_cephes\_exp\_p5);}
\DoxyCodeLine{00111\ \ \ y\ \ =\ pmadd(y,\ r3,\ y1);}
\DoxyCodeLine{00112\ \ \ y\ \ =\ pmadd(y,\ r2,\ y2);}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \textcolor{comment}{//\ Build\ emm0\ =\ 2\string^m.}}
\DoxyCodeLine{00115\ \ \ Packet16i\ emm0\ =\ \_mm512\_cvttps\_epi32(padd(m,\ p16f\_127));}
\DoxyCodeLine{00116\ \ \ emm0\ =\ \_mm512\_slli\_epi32(emm0,\ 23);}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \textcolor{comment}{//\ Return\ 2\string^m\ *\ exp(r).}}
\DoxyCodeLine{00119\ \ \ \textcolor{keywordflow}{return}\ pmax(pmul(y,\ \_mm512\_castsi512\_ps(emm0)),\ \_x);}
\DoxyCodeLine{00120\ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00123\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet8d}
\DoxyCodeLine{00124\ pexp<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ \_x)\ \{}
\DoxyCodeLine{00125\ \ \ \textcolor{keywordflow}{return}\ pexp\_double(\_x);}
\DoxyCodeLine{00126\ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ pexp)}
\DoxyCodeLine{00129\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ pexp)}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00132\ EIGEN\_STRONG\_INLINE\ Packet16h\ pfrexp(\textcolor{keyword}{const}\ Packet16h\&\ a,\ Packet16h\&\ exponent)\ \{}
\DoxyCodeLine{00133\ \ \ Packet16f\ fexponent;}
\DoxyCodeLine{00134\ \ \ \textcolor{keyword}{const}\ Packet16h\ out\ =\ float2half(pfrexp<Packet16f>(half2float(a),\ fexponent));}
\DoxyCodeLine{00135\ \ \ exponent\ =\ float2half(fexponent);}
\DoxyCodeLine{00136\ \ \ \textcolor{keywordflow}{return}\ out;}
\DoxyCodeLine{00137\ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00140\ EIGEN\_STRONG\_INLINE\ Packet16h\ pldexp(\textcolor{keyword}{const}\ Packet16h\&\ a,\ \textcolor{keyword}{const}\ Packet16h\&\ exponent)\ \{}
\DoxyCodeLine{00141\ \ \ \textcolor{keywordflow}{return}\ float2half(pldexp<Packet16f>(half2float(a),\ half2float(exponent)));}
\DoxyCodeLine{00142\ \}}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00145\ EIGEN\_STRONG\_INLINE\ Packet16bf\ pfrexp(\textcolor{keyword}{const}\ Packet16bf\&\ a,\ Packet16bf\&\ exponent)\ \{}
\DoxyCodeLine{00146\ \ \ Packet16f\ fexponent;}
\DoxyCodeLine{00147\ \ \ \textcolor{keyword}{const}\ Packet16bf\ out\ =\ F32ToBf16(pfrexp<Packet16f>(Bf16ToF32(a),\ fexponent));}
\DoxyCodeLine{00148\ \ \ exponent\ =\ F32ToBf16(fexponent);}
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{return}\ out;}
\DoxyCodeLine{00150\ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00153\ EIGEN\_STRONG\_INLINE\ Packet16bf\ pldexp(\textcolor{keyword}{const}\ Packet16bf\&\ a,\ \textcolor{keyword}{const}\ Packet16bf\&\ exponent)\ \{}
\DoxyCodeLine{00154\ \ \ \textcolor{keywordflow}{return}\ F32ToBf16(pldexp<Packet16f>(Bf16ToF32(a),\ Bf16ToF32(exponent)));}
\DoxyCodeLine{00155\ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \textcolor{comment}{//\ Functions\ for\ sqrt.}}
\DoxyCodeLine{00158\ \textcolor{comment}{//\ The\ EIGEN\_FAST\_MATH\ version\ uses\ the\ \_mm\_rsqrt\_ps\ approximation\ and\ one\ step}}
\DoxyCodeLine{00159\ \textcolor{comment}{//\ of\ Newton's\ method,\ at\ a\ cost\ of\ 1-\/2\ bits\ of\ precision\ as\ opposed\ to\ the}}
\DoxyCodeLine{00160\ \textcolor{comment}{//\ exact\ solution.\ The\ main\ advantage\ of\ this\ approach\ is\ not\ just\ speed,\ but}}
\DoxyCodeLine{00161\ \textcolor{comment}{//\ also\ the\ fact\ that\ it\ can\ be\ inlined\ and\ pipelined\ with\ other\ computations,}}
\DoxyCodeLine{00162\ \textcolor{comment}{//\ further\ reducing\ its\ effective\ latency.}}
\DoxyCodeLine{00163\ \textcolor{preprocessor}{\#if\ EIGEN\_FAST\_MATH}}
\DoxyCodeLine{00164\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00165\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00166\ psqrt<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00167\ \ \ Packet16f\ neg\_half\ =\ pmul(\_x,\ pset1<Packet16f>(-\/.5f));}
\DoxyCodeLine{00168\ \ \ \_\_mmask16\ denormal\_mask\ =\ \_mm512\_kand(}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \_mm512\_cmp\_ps\_mask(\_x,\ pset1<Packet16f>((std::numeric\_limits<float>::min)()),}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_CMP\_LT\_OQ),}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \_mm512\_cmp\_ps\_mask(\_x,\ \_mm512\_setzero\_ps(),\ \_CMP\_GE\_OQ));}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ Packet16f\ x\ =\ \_mm512\_rsqrt14\_ps(\_x);}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \textcolor{comment}{//\ Do\ a\ single\ step\ of\ Newton's\ iteration.}}
\DoxyCodeLine{00176\ \ \ x\ =\ pmul(x,\ pmadd(neg\_half,\ pmul(x,\ x),\ pset1<Packet16f>(1.5f)));}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \textcolor{comment}{//\ Flush\ results\ for\ denormals\ to\ zero.}}
\DoxyCodeLine{00179\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_mask\_blend\_ps(denormal\_mask,\ pmul(\_x,x),\ \_mm512\_setzero\_ps());}
\DoxyCodeLine{00180\ \}}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00183\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet8d}
\DoxyCodeLine{00184\ psqrt<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ \_x)\ \{}
\DoxyCodeLine{00185\ \ \ Packet8d\ neg\_half\ =\ pmul(\_x,\ pset1<Packet8d>(-\/.5));}
\DoxyCodeLine{00186\ \ \ \_\_mmask16\ denormal\_mask\ =\ \_mm512\_kand(}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \_mm512\_cmp\_pd\_mask(\_x,\ pset1<Packet8d>((std::numeric\_limits<double>::min)()),}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_CMP\_LT\_OQ),}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \_mm512\_cmp\_pd\_mask(\_x,\ \_mm512\_setzero\_pd(),\ \_CMP\_GE\_OQ));}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ Packet8d\ x\ =\ \_mm512\_rsqrt14\_pd(\_x);}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \textcolor{comment}{//\ Do\ a\ single\ step\ of\ Newton's\ iteration.}}
\DoxyCodeLine{00194\ \ \ x\ =\ pmul(x,\ pmadd(neg\_half,\ pmul(x,\ x),\ pset1<Packet8d>(1.5)));}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \textcolor{comment}{//\ Do\ a\ second\ step\ of\ Newton's\ iteration.}}
\DoxyCodeLine{00197\ \ \ x\ =\ pmul(x,\ pmadd(neg\_half,\ pmul(x,\ x),\ pset1<Packet8d>(1.5)));}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_mask\_blend\_pd(denormal\_mask,\ pmul(\_x,x),\ \_mm512\_setzero\_pd());}
\DoxyCodeLine{00200\ \}}
\DoxyCodeLine{00201\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00202\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00203\ EIGEN\_STRONG\_INLINE\ Packet16f\ psqrt<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ x)\ \{}
\DoxyCodeLine{00204\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_sqrt\_ps(x);}
\DoxyCodeLine{00205\ \}}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00208\ EIGEN\_STRONG\_INLINE\ Packet8d\ psqrt<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ x)\ \{}
\DoxyCodeLine{00209\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_sqrt\_pd(x);}
\DoxyCodeLine{00210\ \}}
\DoxyCodeLine{00211\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ psqrt)}
\DoxyCodeLine{00214\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ psqrt)}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \textcolor{comment}{//\ prsqrt\ for\ float.}}
\DoxyCodeLine{00217\ \textcolor{preprocessor}{\#if\ defined(EIGEN\_VECTORIZE\_AVX512ER)}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00220\ EIGEN\_STRONG\_INLINE\ Packet16f\ prsqrt<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ x)\ \{}
\DoxyCodeLine{00221\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_rsqrt28\_ps(x);}
\DoxyCodeLine{00222\ \}}
\DoxyCodeLine{00223\ \textcolor{preprocessor}{\#elif\ EIGEN\_FAST\_MATH}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00226\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00227\ prsqrt<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00228\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f\_FROM\_INT(inf,\ 0x7f800000);}
\DoxyCodeLine{00229\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(one\_point\_five,\ 1.5f);}
\DoxyCodeLine{00230\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(minus\_half,\ -\/0.5f);}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ Packet16f\ neg\_half\ =\ pmul(\_x,\ p16f\_minus\_half);}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \textcolor{comment}{//\ Identity\ infinite,\ negative\ and\ denormal\ arguments.}}
\DoxyCodeLine{00235\ \ \ \_\_mmask16\ inf\_mask\ =\ \_mm512\_cmp\_ps\_mask(\_x,\ p16f\_inf,\ \_CMP\_EQ\_OQ);}
\DoxyCodeLine{00236\ \ \ \_\_mmask16\ not\_pos\_mask\ =\ \_mm512\_cmp\_ps\_mask(\_x,\ \_mm512\_setzero\_ps(),\ \_CMP\_LE\_OQ);}
\DoxyCodeLine{00237\ \ \ \_\_mmask16\ not\_finite\_pos\_mask\ =\ not\_pos\_mask\ |\ inf\_mask;}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \textcolor{comment}{//\ Compute\ an\ approximate\ result\ using\ the\ rsqrt\ intrinsic,\ forcing\ +inf}}
\DoxyCodeLine{00240\ \ \ \textcolor{comment}{//\ for\ denormals\ for\ consistency\ with\ AVX\ and\ SSE\ implementations.}}
\DoxyCodeLine{00241\ \ \ Packet16f\ y\_approx\ =\ \_mm512\_rsqrt14\_ps(\_x);}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \textcolor{comment}{//\ Do\ a\ single\ step\ of\ Newton-\/Raphson\ iteration\ to\ improve\ the\ approximation.}}
\DoxyCodeLine{00244\ \ \ \textcolor{comment}{//\ This\ uses\ the\ formula\ y\_\{n+1\}\ =\ y\_n\ *\ (1.5\ -\/\ y\_n\ *\ (0.5\ *\ x)\ *\ y\_n).}}
\DoxyCodeLine{00245\ \ \ \textcolor{comment}{//\ It\ is\ essential\ to\ evaluate\ the\ inner\ term\ like\ this\ because\ forming}}
\DoxyCodeLine{00246\ \ \ \textcolor{comment}{//\ y\_n\string^2\ may\ over-\/\ or\ underflow.}}
\DoxyCodeLine{00247\ \ \ Packet16f\ y\_newton\ =\ pmul(y\_approx,\ pmadd(y\_approx,\ pmul(neg\_half,\ y\_approx),\ p16f\_one\_point\_five));}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \textcolor{comment}{//\ Select\ the\ result\ of\ the\ Newton-\/Raphson\ step\ for\ positive\ finite\ arguments.}}
\DoxyCodeLine{00250\ \ \ \textcolor{comment}{//\ For\ other\ arguments,\ choose\ the\ output\ of\ the\ intrinsic.\ This\ will}}
\DoxyCodeLine{00251\ \ \ \textcolor{comment}{//\ return\ rsqrt(+inf)\ =\ 0,\ rsqrt(x)\ =\ NaN\ if\ x\ <\ 0,\ and\ rsqrt(0)\ =\ +inf.}}
\DoxyCodeLine{00252\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_mask\_blend\_ps(not\_finite\_pos\_mask,\ y\_newton,\ y\_approx);}
\DoxyCodeLine{00253\ \}}
\DoxyCodeLine{00254\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00257\ EIGEN\_STRONG\_INLINE\ Packet16f\ prsqrt<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ x)\ \{}
\DoxyCodeLine{00258\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(one,\ 1.0f);}
\DoxyCodeLine{00259\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_div\_ps(p16f\_one,\ \_mm512\_sqrt\_ps(x));}
\DoxyCodeLine{00260\ \}}
\DoxyCodeLine{00261\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ prsqrt)}
\DoxyCodeLine{00264\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ prsqrt)}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \textcolor{comment}{//\ prsqrt\ for\ double.}}
\DoxyCodeLine{00267\ \textcolor{preprocessor}{\#if\ EIGEN\_FAST\_MATH}}
\DoxyCodeLine{00268\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00269\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet8d}
\DoxyCodeLine{00270\ prsqrt<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ \_x)\ \{}
\DoxyCodeLine{00271\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet8d(one\_point\_five,\ 1.5);}
\DoxyCodeLine{00272\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet8d(minus\_half,\ -\/0.5);}
\DoxyCodeLine{00273\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet8d\_FROM\_INT64(inf,\ 0x7ff0000000000000LL);}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ Packet8d\ neg\_half\ =\ pmul(\_x,\ p8d\_minus\_half);}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \textcolor{comment}{//\ Identity\ infinite,\ negative\ and\ denormal\ arguments.}}
\DoxyCodeLine{00278\ \ \ \_\_mmask8\ inf\_mask\ =\ \_mm512\_cmp\_pd\_mask(\_x,\ p8d\_inf,\ \_CMP\_EQ\_OQ);}
\DoxyCodeLine{00279\ \ \ \_\_mmask8\ not\_pos\_mask\ =\ \_mm512\_cmp\_pd\_mask(\_x,\ \_mm512\_setzero\_pd(),\ \_CMP\_LE\_OQ);}
\DoxyCodeLine{00280\ \ \ \_\_mmask8\ not\_finite\_pos\_mask\ =\ not\_pos\_mask\ |\ inf\_mask;}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \textcolor{comment}{//\ Compute\ an\ approximate\ result\ using\ the\ rsqrt\ intrinsic,\ forcing\ +inf}}
\DoxyCodeLine{00283\ \ \ \textcolor{comment}{//\ for\ denormals\ for\ consistency\ with\ AVX\ and\ SSE\ implementations.}}
\DoxyCodeLine{00284\ \textcolor{preprocessor}{\#if\ defined(EIGEN\_VECTORIZE\_AVX512ER)}}
\DoxyCodeLine{00285\ \ \ Packet8d\ y\_approx\ =\ \_mm512\_rsqrt28\_pd(\_x);}
\DoxyCodeLine{00286\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00287\ \ \ Packet8d\ y\_approx\ =\ \_mm512\_rsqrt14\_pd(\_x);}
\DoxyCodeLine{00288\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00289\ \ \ \textcolor{comment}{//\ Do\ one\ or\ two\ steps\ of\ Newton-\/Raphson's\ to\ improve\ the\ approximation,\ depending\ on\ the}}
\DoxyCodeLine{00290\ \ \ \textcolor{comment}{//\ starting\ accuracy\ (either\ 2\string^-\/14\ or\ 2\string^-\/28,\ depending\ on\ whether\ AVX512ER\ is\ available).}}
\DoxyCodeLine{00291\ \ \ \textcolor{comment}{//\ The\ Newton-\/Raphson\ algorithm\ has\ quadratic\ convergence\ and\ roughly\ doubles\ the\ number}}
\DoxyCodeLine{00292\ \ \ \textcolor{comment}{//\ of\ correct\ digits\ for\ each\ step.}}
\DoxyCodeLine{00293\ \ \ \textcolor{comment}{//\ This\ uses\ the\ formula\ y\_\{n+1\}\ =\ y\_n\ *\ (1.5\ -\/\ y\_n\ *\ (0.5\ *\ x)\ *\ y\_n).}}
\DoxyCodeLine{00294\ \ \ \textcolor{comment}{//\ It\ is\ essential\ to\ evaluate\ the\ inner\ term\ like\ this\ because\ forming}}
\DoxyCodeLine{00295\ \ \ \textcolor{comment}{//\ y\_n\string^2\ may\ over-\/\ or\ underflow.}}
\DoxyCodeLine{00296\ \ \ Packet8d\ y\_newton\ =\ pmul(y\_approx,\ pmadd(neg\_half,\ pmul(y\_approx,\ y\_approx),\ p8d\_one\_point\_five));}
\DoxyCodeLine{00297\ \textcolor{preprocessor}{\#if\ !defined(EIGEN\_VECTORIZE\_AVX512ER)}}
\DoxyCodeLine{00298\ \ \ y\_newton\ =\ pmul(y\_newton,\ pmadd(y\_newton,\ pmul(neg\_half,\ y\_newton),\ p8d\_one\_point\_five));}
\DoxyCodeLine{00299\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00300\ \ \ \textcolor{comment}{//\ Select\ the\ result\ of\ the\ Newton-\/Raphson\ step\ for\ positive\ finite\ arguments.}}
\DoxyCodeLine{00301\ \ \ \textcolor{comment}{//\ For\ other\ arguments,\ choose\ the\ output\ of\ the\ intrinsic.\ This\ will}}
\DoxyCodeLine{00302\ \ \ \textcolor{comment}{//\ return\ rsqrt(+inf)\ =\ 0,\ rsqrt(x)\ =\ NaN\ if\ x\ <\ 0,\ and\ rsqrt(0)\ =\ +inf.}}
\DoxyCodeLine{00303\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_mask\_blend\_pd(not\_finite\_pos\_mask,\ y\_newton,\ y\_approx);}
\DoxyCodeLine{00304\ \}}
\DoxyCodeLine{00305\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00306\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00307\ EIGEN\_STRONG\_INLINE\ Packet8d\ prsqrt<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ x)\ \{}
\DoxyCodeLine{00308\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet8d(one,\ 1.0f);}
\DoxyCodeLine{00309\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_div\_pd(p8d\_one,\ \_mm512\_sqrt\_pd(x));}
\DoxyCodeLine{00310\ \}}
\DoxyCodeLine{00311\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \textcolor{keyword}{template}<>\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED}
\DoxyCodeLine{00314\ Packet16f\ plog1p<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00315\ \ \ \textcolor{keywordflow}{return}\ generic\_plog1p(\_x);}
\DoxyCodeLine{00316\ \}}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ plog1p)}
\DoxyCodeLine{00319\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ plog1p)}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ \textcolor{keyword}{template}<>\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED}
\DoxyCodeLine{00322\ Packet16f\ pexpm1<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00323\ \ \ \textcolor{keywordflow}{return}\ generic\_expm1(\_x);}
\DoxyCodeLine{00324\ \}}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ pexpm1)}
\DoxyCodeLine{00327\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ pexpm1)}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00333\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00334\ psin<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00335\ \ \ \textcolor{keywordflow}{return}\ psin\_float(\_x);}
\DoxyCodeLine{00336\ \}}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00339\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00340\ pcos<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00341\ \ \ \textcolor{keywordflow}{return}\ pcos\_float(\_x);}
\DoxyCodeLine{00342\ \}}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00345\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00346\ ptanh<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00347\ \ \ \textcolor{keywordflow}{return}\ internal::generic\_fast\_tanh\_float(\_x);}
\DoxyCodeLine{00348\ \}}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ psin)}
\DoxyCodeLine{00351\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ pcos)}
\DoxyCodeLine{00352\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ ptanh)}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ psin)}
\DoxyCodeLine{00355\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ pcos)}
\DoxyCodeLine{00356\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ ptanh)}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00358\ \}\ \ \textcolor{comment}{//\ end\ namespace\ internal}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \}\ \ \textcolor{comment}{//\ end\ namespace\ Eigen}}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ THIRD\_PARTY\_EIGEN3\_EIGEN\_SRC\_CORE\_ARCH\_AVX512\_MATHFUNCTIONS\_H\_}}

\end{DoxyCode}
